<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Multi-Step Fibo Quiz</title>
  <style>
    body { background: #fff; }
    #answer-box {
      display: block;
      margin: 40px auto 0 auto;
      width: 280px;
      padding: 15px;
      border: 2px dashed #3480d4;
      background: #f3faff;
      text-align: center;
      border-radius: 10px;
      font-size: 16px;
    }
    #answer-box .result { font-weight: bold; font-size: 16px; margin-top:12px; }
    #checkAnswerBtn[disabled], #removeBtn[disabled] { opacity:0.4; cursor:not-allowed; }
    #removeBox, #inputBox { margin-top:15px; }
    #fibIndex, #textAnswer { width:100px; font-size:14px; }
  </style>
</head>
<body>
<div style="position:relative; width:1355px; height:786px; margin:auto; margin-top:40px;">
  <img id="quizImage" src="quiz1.png" style="position:absolute;top:0;left:0;width:1355px;height:786px;z-index:1;">
  <canvas id="quiz1canvas" width="1355" height="786"
    style="position:absolute;top:0;left:0;width:1355px;height:786px;z-index:2; background:rgba(255, 255, 255, 0.05); border:2px solid red; cursor:crosshair;"></canvas>
</div>
<div id="answer-box">
  <div id="question"></div>
  <button id="checkAnswerBtn" disabled>‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
  <div id="inputBox" style="display:none;">
    ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì: <input type="text" id="textAnswer">
    <button id="submitTextBtn">‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</button>
  </div>
  <div style="text-align:center; margin-top:20px;">
    <button onclick="overrideImage=null; showStep();">‡∏Å‡∏•‡∏±‡∏ö‡∏†‡∏≤‡∏û‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</button>
    <button onclick="switchImageFromStep('tf4h')">‡∏î‡∏π TF 4 ‡∏ä‡∏°</button>
    <button onclick="switchImageFromStep('tfday')">‡∏î‡∏π TF Day</button>
  </div>
  <div id="removeBox" style="display:none;">
    ‡πÄ‡∏•‡∏Ç‡∏ü‡∏¥‡πÇ‡∏ö‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö: <input type="number" min="1" id="fibIndex">
    <button id="removeBtn">‡∏•‡∏ö‡∏ü‡∏¥‡πÇ‡∏ö‡∏ô‡∏µ‡πâ</button>
  </div>
  <div class="result"></div>
</div>
<script>
function drawAllVerticalLines() {
  lines.forEach(line => {
    if (line.vertical) drawVertical(line.x, false);  // ‚úÖ ‡πÉ‡∏™‡πà false ‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô
  });
}

function redrawAll() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  const isAltView = overrideImage !== null;

  if (!isAltView) {
    lines.forEach((line, i) => {
      if (!line.vertical) drawFiboLine(line, i);
    });

    if (tempLine) drawFiboLine(tempLine, lines.length);
  }

  // ‚úÖ ‡∏ß‡∏≤‡∏î‡πÄ‡∏™‡πâ‡∏ô‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ
  drawAllVerticalLines(); 

  if (tempX != null && steps[currentStep].type === "vertical") drawVertical(tempX, true);
  drawCrosshair();
}


const steps = [
  {
    type: "input",
    question: "1. ‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡πÄ‡∏´‡πá‡∏ô‡∏ó‡∏±‡πâ‡∏á 3 TF ‡πÄ‡∏£‡∏≤‡∏Ñ‡∏ß‡∏£‡∏à‡∏∞‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡πÄ‡∏ó‡∏£‡∏î‡∏ù‡∏±‡πà‡∏á‡πÑ‡∏´‡∏ô(1.‡∏ù‡∏±‡πà‡∏áBUY 2.‡∏ù‡∏±‡πà‡∏áSELL ‡∏ï‡∏≠‡∏ö‡πÅ‡∏Ñ‡πà1‡∏´‡∏£‡∏∑‡∏≠2)",
    correctAnswer: "1",
    image: "quiz1.png",
    altImages: {
      tf4h: "h4quiz1.png",
      tfday: "dayquiz1.png"
    }
  },
    {
    type: "input",
    question: "2. ‡∏´‡∏≤‡∏Å‡∏≠‡∏¢‡∏≤‡∏Å‡∏à‡∏∞‡πÄ‡∏•‡πà‡∏ô‡∏ù‡∏±‡πà‡∏á BUY ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏≤ 240‡∏Ç‡∏∂‡πâ‡∏ô1‡∏£‡∏≠‡∏ö ‡∏Ñ‡∏ß‡∏£‡∏ß‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ó‡∏£‡∏î‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô 1.‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢ 2.‡∏°‡∏µ‡∏ó‡∏ó‡∏Å‡∏ï (‡∏ï‡∏≠‡∏ö‡πÅ‡∏Ñ‡πà1‡∏´‡∏£‡∏∑‡∏≠2)",
    correctAnswer: "2",
    image: "quiz1.png",
    altImages: {
      tf4h: "h4quiz1.png",
      tfday: "dayquiz1.png"
    }
  },
  {
    type: "draw",
    question: "3. ‡∏à‡∏á‡∏•‡∏≤‡∏Å‡∏ü‡∏¥‡πÇ‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÅ‡∏ö‡∏ö Conservative TF60",
    drawType: "up",
    answer: {x1: 71, y1: 270, x2: 117, y2: 388},
    image: "quiz2.png",
    altImages: {
      tf4h: "h4quiz2.png",
      tfday: "dayquiz2.png"
    }
  },
    {
    type: "draw",
    question: "4. ‡∏à‡∏á‡∏•‡∏≤‡∏Å‡∏ü‡∏¥‡πÇ‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏¢‡∏∏‡∏Å‡∏ï‡πå TF60",
    drawType: "up",
    answer: {x1: 137, y1: 276, x2: 218, y2: 327},
    image: "quiz2.png",
    altImages: {
      tf4h: "h4quiz2.png",
      tfday: "dayquiz2.png"
    }
  },
      {
    type: "input",
    question: "5. ‡∏´‡∏≤‡∏Å‡∏ó‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡πÑ‡∏°‡πâ‡∏ä‡∏∏‡∏î‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡∏Ç‡∏≤‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏£‡∏≠‡∏ö‡∏°‡∏≤ ‡πÄ‡∏õ‡πâ‡∏≤‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£TP‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ô‡∏ß‡πÑ‡∏´‡∏ô (‡∏ï‡∏≠‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏•‡∏Ç‡πÄ‡∏ä‡πà‡∏ô161.8)",
    correctAnswer: "261.8",
    image: "quiz2.png",
    altImages: {
      tf4h: "h4quiz2.png",
      tfday: "dayquiz2.png"
    }
  },
  {
    type: "input",
    question: "6. ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡∏ß‡πà‡∏≤‡∏à‡∏∞ TP‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏ß 261.8 ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏ß‡∏£‡πÄ‡∏õ‡πá‡∏ô 261.8 ‡∏Ç‡∏≠‡∏á ‡∏ü‡∏¥‡πÇ‡∏ö‡∏ä‡∏∏‡∏î‡∏ó‡∏µ‡πà 1 ‡∏´‡∏£‡∏∑‡∏≠ 2 (1.‡∏ä‡∏∏‡∏î‡∏ó‡∏µ‡πà1‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏°‡∏µ‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏•‡∏±‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏Å‡∏±‡∏ö‡∏™‡∏ó‡∏£‡∏Ç‡∏≠‡∏á‡∏ü‡∏¥‡πÇ‡∏ö‡∏ä‡∏∏‡∏î‡∏ó‡∏µ‡πà2 2. ‡∏ä‡∏∏‡∏î‡∏ó‡∏µ‡πà2‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏õ‡πä‡∏≠‡∏î‡πÑ‡∏°‡πà‡∏Å‡∏•‡πâ‡∏≤‡∏ñ‡∏∑‡∏≠)‡∏ï‡∏≠‡∏ö1‡∏´‡∏£‡∏∑‡∏≠2",
    correctAnswer: "1",
    image: "quiz2.png",
    altImages: {
      tf4h: "h4quiz2.png",
      tfday: "dayquiz2.png"
    }
  },
      {
    type: "draw",
    question: "7. ‡∏à‡∏á‡∏•‡∏≤‡∏Å‡∏ü‡∏¥‡πÇ‡∏ö‡∏†‡∏π‡πÄ‡∏Ç‡∏≤‡∏•‡∏π‡∏Å‡∏´‡∏•‡∏±‡∏á‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á TF60",
    drawType: "up",
    answer: {x1: 332, y1: 167, x2: 371, y2: 242},
    image: "quiz3.png",
    altImages: {
      tf4h: "h4quiz3.png",
      tfday: "dayquiz3.png"
    }
  },
        {
    type: "vertical",
    question: "8. ‡∏à‡∏á‡∏ï‡∏±‡∏î‡∏†‡∏π‡πÄ‡∏Ç‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏†‡∏π‡πÄ‡∏Ç‡∏≤‡∏•‡∏π‡∏Å‡∏´‡∏•‡∏±‡∏á‡∏õ‡∏¥‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô161.8 RSI‡∏à‡∏ö‡∏£‡∏≠‡∏ö‡πÅ‡∏•‡∏∞ STO ‡∏•‡∏á‡∏°‡∏≤OVS",
    answerX: 434,
    image: "quiz4.png",
    altImages: {
      tf4h: "h4quiz4.png",
      tfday: "dayquiz4.png"
    }
  },
    {
    question: "9. ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏ö‡∏ü‡∏¥‡πÇ‡∏ö‡∏ó‡∏µ‡πà‡∏´‡∏±‡∏Å‡∏Ñ‡∏≠‡∏õ‡∏¥‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô161.8‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏î‡∏†‡∏π‡πÄ‡∏Ç‡∏≤‡πÅ‡∏•‡πâ‡∏ß  ",
    type: "remove",
    removeIndex: 2,
      image: "quiz4.png",
    altImages: {
      tf4h: "h4quiz4.png",
      tfday: "dayquiz4.png"
    }
  },
  {
    type: "input",
    question: "10. ‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏û‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏î‡∏†‡∏π‡πÄ‡∏Ç‡∏≤‡πÅ‡∏•‡πâ‡∏ß‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏°‡∏≠‡∏á‡πÅ‡∏ú‡∏ô SELL ‡πÑ‡∏î‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡πÇ‡∏õ‡∏£‡∏î‡∏î‡∏π TF‡πÉ‡∏´‡∏ç‡πà‡∏Å‡∏ß‡πà‡∏≤‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö(‡∏ï‡∏≠‡∏ö‡πÑ‡∏î‡πâ/‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)",
    correctAnswer: "‡πÑ‡∏î‡πâ",
    image: "quiz4.png",
    altImages: {
      tf4h: "h4quiz4.png",
      tfday: "dayquiz4.png"
    }
    },
      {
    type: "input",
    question: "11. ‡∏´‡∏≤‡∏Å‡∏°‡∏≠‡∏á‡πÅ‡∏ú‡∏ôSELL‡∏Ñ‡∏ß‡∏£‡∏£‡∏≠‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á 1.240 ‡∏°‡∏µ‡∏ó‡∏ó‡∏Å‡∏ï 2. 60‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏Æ‡∏°‡∏µ‡∏ó‡∏ó‡∏Å‡∏ï 3.‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á2‡∏Ç‡πâ‡∏≠ (‡∏ï‡∏≠‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç) ",
    correctAnswer: "3",
    image: "quiz4.png",
    altImages: {
      tf4h: "h4quiz4.png",
      tfday: "dayquiz4.png"
    }
    },
          {
    type: "draw",
    question: "12. ‡∏à‡∏á‡∏•‡∏≤‡∏Å‡∏ü‡∏¥‡πÇ‡∏ö‡∏Ç‡∏≤‡∏•‡∏á‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á TF60",
    drawType: "down",
    answer: {x1: 473, y1: 191, x2: 545, y2: 160},
    image: "quiz5.png",
    altImages: {
      tf4h: "h4quiz5.png",
      tfday: "dayquiz5.png"
    }
  },
  {
    type: "input",
    question: "13. ‡∏à‡∏≤‡∏Å‡∏†‡∏≤‡∏û‡∏•‡πà‡∏≤‡∏´‡∏±‡∏ß‡∏•‡∏á‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á‡πÄ‡∏õ‡πâ‡∏≤‡πÑ‡∏î‡πâ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà (‡∏ï‡∏≠‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏ä‡πà‡∏ô 161.8)",
    correctAnswer: "261.8",
    image: "quiz5.png",
    altImages: {
      tf4h: "h4quiz5.png",
      tfday: "dayquiz5.png"
    }
    },
          {
    type: "draw",
    question: "14. ‡∏à‡∏á‡∏•‡∏≤‡∏Å‡∏ü‡∏¥‡πÇ‡∏ö‡∏Ç‡∏≤‡∏•‡∏á‡∏†‡∏π‡πÄ‡∏Ç‡∏≤‡∏•‡∏π‡∏Å‡∏´‡∏•‡∏±‡∏á‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á TF60",
    drawType: "down",
    answer: {x1: 541, y1: 236, x2: 604, y2: 189},
    image: "quiz6.png",
    altImages: {
      tf4h: "h4quiz6.png",
      tfday: "dayquiz6.png"
    }
  },
    {
    type: "input",
    question: "15. ‡∏à‡∏≤‡∏Å‡∏´‡∏±‡∏ß‡∏†‡∏π‡πÄ‡∏Ç‡∏≤‡∏•‡∏π‡∏Å‡∏´‡∏•‡∏±‡∏á‡∏ñ‡πâ‡∏≤‡∏´‡∏≤‡∏Å‡πÄ‡∏£‡∏≤‡πÑ‡∏î‡πâ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏•‡∏π‡∏Å‡∏ô‡∏µ‡πâ‡πÇ‡∏î‡∏¢‡∏™‡πà‡∏ß‡∏ô‡∏°‡∏≤‡∏Å‡∏à‡∏∞‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πâ‡∏≤‡πÄ‡∏ó‡πà‡∏≤‡πÑ‡∏´‡∏£‡πà (‡∏ï‡∏≠‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡πÄ‡∏ä‡πà‡∏ô 161.8)",
    correctAnswer: "200",
    image: "quiz6.png",
    altImages: {
      tf4h: "h4quiz6.png",
      tfday: "dayquiz6.png"
    }
    },
     {
    type: "draw",
    question: "16. ‡∏à‡∏á‡∏•‡∏≤‡∏Å‡∏ü‡∏¥‡πÇ‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡πÅ‡∏ö‡∏ö‡∏´‡∏±‡∏Å‡∏Ñ‡∏≠ TF60",
    drawType: "up",
    answer: {x1: 598, y1: 187, x2: 648, y2: 277},
    image: "quiz7.png",
    altImages: {
      tf4h: "h4quiz6.png",
      tfday: "dayquiz6.png"
    }
  },
      {
    type: "vertical",
    question: "17. ‡∏à‡∏á‡∏ï‡∏±‡∏î‡∏†‡∏π‡πÄ‡∏Ç‡∏≤‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ü‡∏¥‡πÇ‡∏ö‡∏Ç‡∏≤‡∏•‡∏á‡∏ñ‡∏π‡∏Å‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡πÅ‡∏•‡∏∞ RSI ‡∏à‡∏ö‡∏£‡∏≠‡∏ö ",
    answerX: 633,
    image: "quiz7.png",
    altImages: {
      tf4h: "h4quiz6.png",
      tfday: "dayquiz6.png"
    }
  },
        {
    question: "18. ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏ö‡∏ü‡∏¥‡πÇ‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ó‡∏≥‡∏•‡∏≤‡∏¢  ",
    type: "remove",
    removeIndex: 4,
      image: "quiz7.png",
    altImages: {
      tf4h: "h4quiz6.png",
      tfday: "dayquiz6.png"
    }
  },
      {
    question: "19. ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏ö‡∏ü‡∏¥‡πÇ‡∏ö‡∏ó‡∏µ‡πà‡∏´‡∏±‡∏Å‡∏Ñ‡∏≠‡∏õ‡∏¥‡∏î‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô161.8‡πÅ‡∏•‡∏∞‡∏ï‡∏±‡∏î‡∏†‡∏π‡πÄ‡∏Ç‡∏≤‡πÅ‡∏•‡πâ‡∏ß  ",
    type: "remove",
    removeIndex: 4,
      image: "quiz8.png",
    altImages: {
      tf4h: "h4quiz8.png",
      tfday: "dayquiz8.png"
    }
  },
     {
    type: "draw",
    question: "20. ‡∏à‡∏á‡∏•‡∏≤‡∏Å‡∏ü‡∏¥‡πÇ‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏ï‡∏±‡∏î‡∏†‡∏π‡πÄ‡∏Ç‡∏≤ TF60",
    drawType: "up",
    answer: {x1: 675, y1: 184, x2: 736, y2: 250},
    image: "quiz8.png",
    altImages: {
      tf4h: "h4quiz8.png",
      tfday: "dayquiz8.png"
    }
  },
  {
    type: "input",
    question: "21. ‡∏à‡∏≤‡∏Å‡∏ü‡∏¥‡πÇ‡∏ö‡∏ä‡∏∏‡∏î‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ä‡∏∏‡∏î‡∏ï‡πâ‡∏ô‡∏£‡∏≠‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡∏†‡∏π‡πÄ‡∏Ç‡∏≤‡∏•‡∏π‡∏Å‡∏´‡∏•‡∏±‡∏á ",
    correctAnswer: "‡∏†‡∏π‡πÄ‡∏Ç‡∏≤‡∏•‡∏π‡∏Å‡∏´‡∏•‡∏±‡∏á",
    image: "quiz8.png",
    altImages: {
      tf4h: "h4quiz8.png",
      tfday: "dayquiz8.png"
    }
    },
      {
    type: "input",
    question: "22. ‡∏´‡∏≤‡∏Å‡πÄ‡∏£‡∏≤‡πÑ‡∏î‡πâ‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡∏ü‡∏¥‡πÇ‡∏ö‡∏ä‡∏∏‡∏î‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÑ‡∏õ TP ‡∏ó‡∏µ‡πà‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì‡πÇ‡∏ã‡∏ô‡πÑ‡∏´‡∏ô 1.261.8‡∏Ç‡∏≠‡∏á ‡∏†‡∏π‡πÄ‡∏Ç‡∏≤‡∏•‡∏π‡∏Å‡∏´‡∏•‡∏±‡∏á 2. 200 ‡∏Ç‡∏≠‡∏á‡∏†‡∏π‡πÄ‡∏Ç‡∏≤‡∏•‡∏π‡∏Å‡∏´‡∏•‡∏±‡∏á (‡∏ï‡∏≠‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç) ",
    correctAnswer: "200",
    image: "quiz8.png",
    altImages: {
      tf4h: "h4quiz8.png",
      tfday: "dayquiz8.png"
    }
    },
          {
    type: "input",
    question: "23. ‡∏ó‡∏≥‡πÑ‡∏°‡∏ñ‡∏∂‡∏á TP ‡∏ó‡∏µ‡πà 200 ‡∏Ç‡∏≠‡∏á‡∏†‡∏π‡πÄ‡∏Ç‡∏≤‡∏•‡∏π‡∏Å‡∏´‡∏•‡∏±‡∏á ? 1.‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏™‡πà‡∏ß‡∏ô‡∏°‡∏≤‡∏Å‡∏†‡∏Ç‡∏•‡∏•‡∏à‡∏∞‡∏à‡∏ö‡∏ó‡∏µ‡πà200 2.‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏°‡∏µ‡πÄ‡∏õ‡πâ‡∏≤‡∏ü‡∏¥‡πÇ‡∏ö‡πÅ‡∏ö‡∏ö‡∏õ‡∏£‡∏∞‡∏¢‡∏∏‡∏Å‡∏ï‡πå‡∏™‡∏∏‡∏î‡∏ó‡∏≤‡∏á‡∏£‡∏±‡∏Å‡∏Ñ‡∏•‡∏±‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏≠‡∏¢‡∏π‡πà 3.‡πÄ‡∏û‡∏£‡∏≤‡∏∞‡∏°‡∏µ‡πÅ‡∏ô‡∏ß 261.8 ‡∏Ç‡∏≠‡∏á‡∏ä‡∏∏‡∏î‡∏ï‡πâ‡∏ô‡∏£‡∏≠‡∏ö‡∏≠‡∏¢‡∏π‡πà 4.‡∏ñ‡∏π‡∏Å‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠ ",
    correctAnswer: "4",
    image: "quiz8.png",
    altImages: {
      tf4h: "h4quiz8.png",
      tfday: "dayquiz8.png"
    }
    },
       {
    type: "input",
    question: "24. ‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å‡∏´‡∏°‡∏î‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡πâ‡∏ßDEV‡∏Ç‡∏≠‡∏û‡∏±‡∏Å‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö ‡πÅ‡∏ï‡πà‡∏ñ‡πâ‡∏≤‡∏û‡∏¥‡∏°‡∏ß‡πà‡∏≤ ‡πÅ‡∏≠‡∏î‡πÄ‡∏°‡∏≤‡∏Å‡∏≤‡∏ß‡∏´‡∏•‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‡∏ú‡∏°‡∏à‡∏∞‡∏°‡∏µ‡πÅ‡∏£‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö :) ",
    correctAnswer: "‡πÅ‡∏≠‡∏î‡πÄ‡∏°‡∏≤‡∏Å‡∏≤‡∏ß‡∏´‡∏•‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î",
    image: "quiz9.png",
    altImages: {
      tf4h: "h4quiz8.png",
      tfday: "dayquiz8.png"
    }
    },
];

let currentStep = 0;
let lines = [], tempLine = null, tempX = null;
let crossX = null, crossY = null;
let isDrawing = false, startX = 0, startY = 0, endX = 0, endY = 0, isFinishedDraw = false;
let overrideImage = null;

const canvas = document.getElementById('quiz1canvas');
const ctx = canvas.getContext('2d');
const questionDiv = document.getElementById('question');
const checkBtn = document.getElementById('checkAnswerBtn');
const resultDiv = document.querySelector('.result');
const removeBox = document.getElementById('removeBox');
const removeBtn = document.getElementById('removeBtn');
const fibIndexInput = document.getElementById('fibIndex');
const inputBox = document.getElementById('inputBox');
const textAnswer = document.getElementById('textAnswer');
const submitTextBtn = document.getElementById('submitTextBtn');
const quizImage = document.getElementById('quizImage');

function switchImageFromStep(tfKey) {
  const step = steps[currentStep];
  if (step.altImages && step.altImages[tfKey]) {
    overrideImage = step.altImages[tfKey];
    quizImage.src = overrideImage;
    redrawAll(); // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ã‡πà‡∏≠‡∏ô‡∏ü‡∏¥‡πÇ‡∏ö‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
  } else {
    alert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏†‡∏≤‡∏û TF ‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ô‡∏µ‡πâ");
  }
}


function showStep() {
  const step = steps[currentStep];
  if (overrideImage) quizImage.src = overrideImage;
  else if (step.image) quizImage.src = step.image;

  questionDiv.textContent = step.question || "";
  resultDiv.textContent = "";

  checkBtn.style.display = step.type === "remove" || step.type === "input" ? "none" : "inline-block";
  removeBox.style.display = step.type === "remove" ? "inline-block" : "none";
  inputBox.style.display = step.type === "input" ? "block" : "none";
  checkBtn.disabled = true;

  tempLine = null;
  if (step.type !== "vertical") tempX = null;  // ‚ùó‡∏•‡πâ‡∏≤‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á
  isFinishedDraw = false;
  redrawAll();
}

submitTextBtn.onclick = function() {
  const userAnswer = textAnswer.value.trim();
  const correct = steps[currentStep].correctAnswer.trim();
  if (userAnswer.toLowerCase() === correct.toLowerCase()) {
    resultDiv.innerHTML = `<span style="color:#237b13;">‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ó‡∏≥‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏ï‡πà‡∏≠‡πÑ‡∏õ</span>`;
    currentStep++;
    if (currentStep < steps.length) showStep();
    else questionDiv.textContent = "‡∏à‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡πâ‡∏ß!";
  } else {
    resultDiv.innerHTML = `<span style="color:#c00;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏•‡∏≠‡∏á‡∏ï‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà</span>`;
  }
};

function redrawAll() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  const isAltView = overrideImage !== null;

  if (!isAltView) {
    lines.forEach((line, i) => {
      if (!line.vertical) drawFiboLine(line, i);
    });

    if (tempLine) drawFiboLine(tempLine, lines.length);
  }

  drawAllVerticalLines(); // ‚úÖ ‡πÉ‡∏™‡πà‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö

  if (tempX != null && steps[currentStep].type === "vertical") drawVertical(tempX, true);
  drawCrosshair();
}



function drawFiboLine(line, idx) {
  const fibo_levels = [0, 1, 1.272, 1.618, 2, 2.618, 4.236];
  let {x1, y1, x2, y2, type, color} = line;
  fibo_levels.forEach(level => {
    const y = type === "down" ? y2 + (y1 - y2) * level : y2 - (y2 - y1) * level;
    ctx.beginPath(); ctx.moveTo(x1, y); ctx.lineTo(x2, y);
    ctx.strokeStyle = color; ctx.setLineDash([7, 5]); ctx.stroke(); ctx.setLineDash([]);
    ctx.font = "15px Arial"; ctx.fillStyle = "#CC00FF";
    ctx.fillText((level * 100).toFixed(1) + "%", x2 + 12, y - 6);
  });
  ctx.beginPath(); ctx.moveTo(x1, y1); ctx.lineTo(x2, y2);
  ctx.strokeStyle = color; ctx.lineWidth = 1.8; ctx.setLineDash([]); ctx.stroke();
  ctx.font = "bold 30px Arial"; ctx.fillStyle = "#000";
  ctx.fillText(idx + 1, (x1 + x2) / 2, (y1 + y2) / 2);
}

function drawVertical(x, temp=false) {
  ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, canvas.height);
  ctx.strokeStyle = temp ? "#8000ff" : "#8000ff";
  ctx.setLineDash([14, 9]); ctx.stroke(); ctx.setLineDash([]);
  if (!temp) {
    ctx.font = "bold 30px Arial"; ctx.fillStyle = "#8000ff";
    ctx.fillText("V", x + 7, 35);
  }
}

function drawCrosshair() {
  if (crossX != null && crossY != null) {
    ctx.save(); ctx.setLineDash([4, 8]);
    ctx.strokeStyle = "#aaa"; ctx.lineWidth = 1.25;
    ctx.beginPath(); ctx.moveTo(crossX, 0); ctx.lineTo(crossX, canvas.height); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(0, crossY); ctx.lineTo(canvas.width, crossY); ctx.stroke();
    ctx.setLineDash([]); ctx.restore();
  }
}

canvas.addEventListener('mouseleave', () => { crossX = null; crossY = null; redrawAll(); });
canvas.addEventListener('mousedown', e => {
  if (steps[currentStep].type !== "draw") return;
  const rect = canvas.getBoundingClientRect();
  startX = e.clientX - rect.left;
  startY = e.clientY - rect.top;
  isDrawing = true; checkBtn.disabled = true;
  tempLine = null; redrawAll();
});
canvas.addEventListener('mouseup', e => {
  if (!isDrawing || steps[currentStep].type !== "draw") return;
  isDrawing = false;
  const rect = canvas.getBoundingClientRect();
  endX = e.clientX - rect.left;
  endY = e.clientY - rect.top;
  console.log(`DRAW ‚Üí x1: ${Math.round(startX)}, y1: ${Math.round(startY)}, x2: ${Math.round(endX)}, y2: ${Math.round(endY)}`);
  tempLine = {
    x1: startX, y1: startY, x2: endX, y2: endY,
    type: steps[currentStep].drawType,
    color: steps[currentStep].drawType === "down" ? "red" : "green"
  };
  isFinishedDraw = true;
  checkBtn.disabled = false;
  redrawAll();
});
canvas.addEventListener('mousemove', e => {
  const rect = canvas.getBoundingClientRect();
  crossX = e.clientX - rect.left;
  crossY = e.clientY - rect.top;
  if (isDrawing && steps[currentStep].type === "draw") {
    endX = crossX;
    endY = crossY;
    tempLine = {
      x1: startX, y1: startY, x2: endX, y2: endY,
      type: steps[currentStep].drawType,
      color: steps[currentStep].drawType === "down" ? "red" : "green"
    };
  }
  redrawAll();
});
canvas.addEventListener('click', e => {
  if (steps[currentStep].type !== "vertical") return;
  const rect = canvas.getBoundingClientRect();
  tempX = e.clientX - rect.left;
  isFinishedDraw = true;
  checkBtn.disabled = false;
  resultDiv.textContent = "";

  // ‚úÖ log ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á
  console.log(`üü™ VERTICAL LINE CLICKED at X: ${Math.round(tempX)}`);

  redrawAll();
});


checkBtn.onclick = function() {
  const step = steps[currentStep];
  if (step.type === "vertical") {
    if (Math.abs(tempX - step.answerX) < 20) {
      lines.push({ vertical: true, x: tempX, color: "#8000ff" }); // ‚úÖ Fix ‡πÅ‡∏•‡πâ‡∏ß
      tempX = null;
      resultDiv.innerHTML = `<span style='color:#237b13;'>‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! ‡πÑ‡∏õ‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡πÑ‡∏õ</span>`;
      currentStep++;
      if (currentStep < steps.length) showStep();
      else questionDiv.textContent = "‡∏à‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡πâ‡∏ß!";
    } else {
      resultDiv.innerHTML = `<span style='color:#c00;'>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</span>`;
    }
    return;
}
  if (!isFinishedDraw || !tempLine) return;
  const answer = step.answer;
  if (Math.abs(tempLine.y1 - answer.y1) < 10 && Math.abs(tempLine.y2 - answer.y2) < 10) {
    lines.push(tempLine); tempLine = null;
    resultDiv.innerHTML = `<span style='color:#237b13;'>‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á! ‡πÑ‡∏õ‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡πÑ‡∏õ</span>`;
    currentStep++;
    if (currentStep < steps.length) showStep();
    else questionDiv.textContent = "‡∏à‡∏ö‡∏ó‡∏∏‡∏Å‡∏Ç‡πâ‡∏≠‡πÅ‡∏•‡πâ‡∏ß!";
  } else {
    resultDiv.innerHTML = `<span style='color:#c00;'>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</span>`;
  }
};

removeBtn.onclick = function() {
  const idx = parseInt(fibIndexInput.value, 10) - 1;
  const correctIdx = steps[currentStep].removeIndex;
  if (idx === correctIdx) {
    lines.splice(idx, 1);
    resultDiv.innerHTML = `<span style='color:#237b13;'>‡∏•‡∏ö‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</span>`;
    currentStep++;
    showStep();
  } else {
    resultDiv.innerHTML = `<span style='color:#c00;'>‡∏•‡∏ö‡∏ú‡∏¥‡∏î‡πÄ‡∏™‡πâ‡∏ô</span>`;
  }
};

showStep();
</script>
</body>
</html>
